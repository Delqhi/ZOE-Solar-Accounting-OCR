# Story F2 — Bessere Fehlermeldungen/Statusanzeigen bei OCR-Fail/Fallback-Fail

## Beschreibung

Wenn OCR (Gemini) und/oder der Fallback (SiliconFlow Vision) scheitern, soll der Nutzer **klar** sehen:
- dass die KI-Extraktion nicht erfolgreich war,
- *warum* (z.B. Key fehlt, PDF zu groß, Provider down),
- *was als Nächstes zu tun ist* (Retry, manuell erfassen, PDF splitten, Key setzen).

Heute wird ein OCR-Fail häufig als „irgendwie erfolgreich“ behandelt (Template-Daten), was zu Verwirrung führen kann. Ziel ist eine eindeutige, handlungsorientierte Status-/Fehlerdarstellung ohne neue Views.

## Akzeptanzkriterien

- Status & Fehlermeldung:
  - Wenn **beide** Provider nicht liefern (oder nur ein Fallback-Template zurückkommt), wird der Beleg **nicht** als `COMPLETED` dargestellt.
  - Der Beleg erhält einen eindeutigen Status (`ERROR` oder `REVIEW_NEEDED`) und eine verständliche Fehlermeldung (`DocumentRecord.error`).
- Fehlerursachen werden sichtbar (mind. in Detailansicht):
  - `SILICONFLOW_API_KEY` fehlt → Hinweis „Key in .env setzen“.
  - PDF zu groß / Seitenlimit → Hinweis „PDF verkleinern/splitten“.
  - Provider HTTP/Quota/Timeout → Hinweis „Dienst nicht erreichbar/Quota“.
- UI (ohne neue Seiten):
  - In Listen/Grid wird ein Fehlerzustand klar angezeigt (z.B. Badge/Label „Fehler“ statt Score).
  - In der Detailansicht wird eine Fehlerbox mit Next Steps gezeigt.
  - „Retry OCR“ bleibt möglich (sofern nicht Duplikat).
- Keine Silent Fails:
  - Ein OCR-Fail darf nicht unbemerkt zu `bruttoBetrag = 0` + „Manuelle Eingabe erforderlich“ führen, ohne dass der Fehlerzustand sichtbar ist.

## Out of Scope

- Neue Seiten/Views
- Playwright/E2E
- Telemetrie/Logging-Infrastruktur

## Touchpoints

- App.tsx (Statussetzung bei OCR-Ergebnis / Fehlerpfade)
- services/geminiService.ts (Fehlergründe weiterreichen / Meta)
- services/fallbackService.ts (Fehlergründe differenzieren statt generisch)
- components/DatabaseView.tsx / components/DatabaseGrid.tsx (Fehlerbadge)
- components/DetailModal.tsx (Fehlerbox + Next Steps)
- types.ts (nur falls Meta-Felder ergänzt werden; ansonsten `DocumentRecord.error` nutzen)

## Test-Hinweise

- Manuell:
  - `.env` ohne `SILICONFLOW_API_KEY` → Upload erzwingt klaren Fehlerhinweis.
  - Upload eines PDFs > Limit → klare Meldung.
  - Provider absichtlich „kaputt“ (z.B. invalid Key) → klare Meldung.
- Regression: `npm run check`.
