# ðŸ¤– ZOE Solar Accounting OCR - Global Claude Instructions

**Version:** 2026.1
**Purpose:** Ultimate MCP agent delegation for 100% error-free code
**Workflow:** Ralph-Loop with autonomous delegation

---

## ðŸŽ¯ **MISSION CRITICAL - ALWAYS FOLLOW**

### **The 5-Second Delegation Rule**
When you receive ANY task, within 5 seconds you MUST decide:

1. **Is it code?** â†’ Delegate to **Serena MCP** immediately
2. **Need research?** â†’ Use **Tavily MCP** immediately
3. **Need visuals?** â†’ Use **Canva MCP** immediately
4. **Complex multi-step?** â†’ Activate **Ralph-Loop**
5. **Simple fix?** â†’ Do it yourself

### **Prime Directive**
```
ALWAYS delegate to specialized agents when available.
NEVER attempt to do everything yourself.
USE MCP servers for ALL specialized tasks.
OPTIMIZE for speed and quality through delegation.
```

---

## ðŸ§© **MCP SERVER INTEGRATION**

### **1. Serena MCP (Code Editing) - P0 CRITICAL**
```bash
# Activation: IMMEDIATE for any code task
# Tools: find_symbol, replace_symbol_body, insert_after_symbol, rename_symbol, etc.
```

**When to use:**
- âœ… Any file modification needed
- âœ… Code analysis required
- âœ… Symbol navigation
- âœ… Refactoring tasks
- âœ… Finding code references
- âœ… Reading and editing files

**Example:**
```
User: "Fix the unused variable in App.tsx"
â†’ IMMEDIATE delegation to Serena
â†’ Serena: Finds symbol, analyzes, fixes
â†’ You: Verify and report
```

### **2. Tavily MCP (Web Research) - P1 HIGH**
```bash
# Activation: When you need current information beyond knowledge cutoff
# Tools: search, research, get_context
```

**When to use:**
- âœ… "Research best practices for X"
- âœ… "Find current documentation for Y"
- âœ… "What's the latest version of Z?"
- âœ… "2026 trends in..."
- âœ… Real-time information needs

**Example:**
```
User: "What are the latest MCP best practices?"
â†’ Delegate to Tavily
â†’ Tavily: Searches current docs
â†’ You: Synthesize findings
```

### **3. Canva MCP (Visual Design) - P2 MEDIUM**
```bash
# Activation: When visual output is needed
# Tools: create_design, add_elements, export_design, generate_diagram
```

**When to use:**
- âœ… "Create a diagram of the architecture"
- âœ… "Make a presentation slide"
- âœ… "Design a logo"
- âœ… "Generate flowchart"
- âœ… "Create visual mockup"

**Example:**
```
User: "Create a diagram of our agent system"
â†’ Delegate to Canva MCP
â†’ Canva: Generates professional diagram
â†’ You: Integrate into documentation
```

---

## ðŸ”„ **RALPH-LOOP WORKFLOW**

### **Automatic Triggers**
Activate Ralph-Loop when you see these phrases:
- "mach alle error weg"
- "alles soll 100% funktinoieren"
- "fix everything"
- "100% working"
- "commit and deploy"
- "design muss optimal sein"

### **5-Phase Protocol**

#### **Phase 1: ANALYZE (0-5 seconds)**
```bash
npm run build
npx tsc --noEmit
npm run lint
node .claude/commands/console-check.js
```

#### **Phase 2: DELEGATE (5-30 seconds)**
```
For each issue found:
  IF code issue â†’ Serena MCP
  IF research needed â†’ Tavily MCP
  IF visual needed â†’ Canva MCP
  IF complex â†’ Multiple agents + Ralph-Loop
```

#### **Phase 3: EXECUTE (30-120 seconds)**
```
Serena: Fixes all code issues
Tavily: Researches best practices
Canva: Creates visual documentation
You: Coordinate and verify
```

#### **Phase 4: VALIDATE (120-150 seconds)**
```bash
./validate.sh
node .claude/commands/console-check.js
```

#### **Phase 5: ITERATE or EXIT**
```
IF errors remain:
  â†’ Go back to Phase 2
ELSE:
  â†’ Report success
  â†’ Commit changes (if requested)
  â†’ Deploy (if requested)
```

---

## ðŸ“‹ **DELEGATION DECISION MATRIX**

```
Task Received
    â”‚
    â”œâ”€â†’ Is it code? â”€â”€YESâ”€â”€â†’ Serena MCP
    â”‚                     â”‚
    â”‚                     â””â”€â†’ Complex? â”€â”€YESâ”€â”€â†’ Ralph-Loop
    â”‚
    â”œâ”€â†’ Need info? â”€â”€YESâ”€â”€â†’ Tavily MCP
    â”‚                     â”‚
    â”‚                     â””â”€â†’ Current docs? â”€â”€YESâ”€â”€â†’ Always Tavily
    â”‚
    â”œâ”€â†’ Visual? â”€â”€YESâ”€â”€â†’ Canva MCP
    â”‚
    â””â”€â†’ Simple fix? â”€â”€YESâ”€â”€â†’ Do it yourself
```

### **Priority Queue**

| Priority | Task Type | Agent/MCP | Response Time |
|----------|-----------|-----------|---------------|
| **P0** | Build errors | Serena | Immediate |
| **P0** | TypeScript errors | Serena | Immediate |
| **P0** | Security issues | Serena + Manual | Immediate |
| **P1** | ESLint errors | Serena | < 10s |
| **P1** | Runtime errors | Serena + Ralph | < 30s |
| **P2** | Visual bugs | Serena + Canva | < 60s |
| **P2** | Research needed | Tavily | < 30s |
| **P3** | Documentation | Canva + Tavily | < 120s |
| **P3** | Optimization | Serena + Tavily | < 180s |

---

## ðŸ›  **UNIVERSAL COMMANDS**

### **Quick Validation**
```bash
./validate.sh
```
Runs all checks: build, TypeScript, ESLint, tests, security, environment.

### **Console Check (Visual Testing)**
```bash
# Install Playwright once
npx playwright install chromium

# Test local
node .claude/commands/console-check.js

# Test with visible browser
node .claude/commands/console-check.js --visible

# Test production
node .claude/commands/console-check.js https://zoe-solar-accounting-ocr.vercel.app
```

**What it checks:**
- âœ… ALL browser console messages (logs, warnings, errors)
- âœ… JavaScript exceptions and crashes
- âœ… Failed API calls and 404s
- âœ… DOM errors in UI
- âœ… Tailwind CSS functionality
- âœ… Favicon loading
- âœ… React error boundaries
- âœ… Screenshots for documentation

### **Visual Test**
```bash
node test-visual.js
```

### **Full Validation**
```bash
./validate.sh && node .claude/commands/console-check.js
```

---

## ðŸŽ¯ **SUCCESS CRITERIA - 100% ERROR-FREE**

### **Code Quality**
- [ ] Build: 0 errors
- [ ] TypeScript: 0 errors
- [ ] ESLint: 0 errors
- [ ] Tests: all passing

### **Visual/Functional**
- [ ] Visual test: clean
- [ ] Console check: clean
- [ ] DOM errors: none
- [ ] Tailwind: working
- [ ] Favicon: present

### **Deployment Ready**
- [ ] All changes committed
- [ ] Clear commit message
- [ ] Pushed to remote
- [ ] Deployed (if requested)

---

## ðŸ¤– **AUTOMATIC CLAUDE WORKFLOW**

When you say "fix all errors" or "make everything work", Claude automatically:

### **1. Diagnose**
```bash
npm run build
npx tsc --noEmit
npm run lint
```

### **2. Fix Systematically**
- Build errors â†’ Fix immediately
- TypeScript errors â†’ Fix immediately
- ESLint errors â†’ Fix immediately
- Runtime errors â†’ Test and verify
- Browser errors â†’ Use visual testing

### **3. Verify**
```bash
./validate.sh
node test-visual.js
node .claude/commands/console-check.js
```

### **4. Report**
```
âœ… Build: 0 errors
âœ… TypeScript: 0 errors
âœ… ESLint: 0 errors
âœ… Visual: Clean
âœ… Console: Clean

ðŸŽ¯ Result: 100% Error-Free
```

---

## ðŸ“š **QUICK REFERENCE**

### **Common Issues & Fixes**

| Issue | Fix |
|-------|-----|
| Unused variable | Prefix with `_` or remove |
| Unused import | Remove import |
| Console log | Add `eslint-disable` or remove |
| Missing favicon | Add data URI to index.html |
| Tailwind warning | Verify vite.config.ts |
| TypeScript error | Fix interface/type mismatch |
| Build error | Fix syntax/import issues |
| Browser errors | Run `/console-check` |

### **Delegation Triggers**

| User Says | Action |
|-----------|--------|
| "fix all errors" | Ralph-Loop |
| "research X" | Tavily |
| "create diagram" | Canva |
| "refactor Y" | Serena |
| "100% working" | Ralph-Loop |

---

## ðŸš€ **GETTING STARTED**

### **Step 1: Verify MCP Servers**
```bash
# Check Serena
which serena

# Check Tavily
echo $TAVILY_API_KEY

# Check Canva
echo $CANVA_API_KEY
```

### **Step 2: Test Delegation**
```bash
# Try a simple delegation
echo "Fix unused variables in App.tsx" | claude
```

### **Step 3: Activate Ralph-Loop**
```bash
# Test the full workflow
./validate.sh && node .claude/commands/console-check.js
```

---

## ðŸ† **2026 BEST PRACTICES**

### **1. Always Delegate First**
```markdown
âŒ WRONG: "I'll research and fix this myself"
âœ… RIGHT: "Let me delegate to the right agent/MCP"
```

### **2. Use Ralph-Loop for Complex Tasks**
```markdown
âŒ WRONG: One-shot fixes without validation
âœ… RIGHT: Loop until 100% perfect
```

### **3. Validate Everything**
```markdown
âŒ WRONG: "It should work"
âœ… RIGHT: "I verified it works with these tests"
```

### **4. Document Delegation**
```markdown
âŒ WRONG: Silent delegation
âœ… RIGHT: "â†’ Delegating to Serena for code fix"
```

### **5. Speed Over Perfection (Initially)**
```markdown
âŒ WRONG: Spending hours on one issue
âœ… RIGHT: Delegate quickly, iterate fast
```

---

## ðŸ“ž **SUPPORT & TROUBLESHOOTING**

### **When Delegation Fails**
1. Check MCP server status
2. Verify API keys in .env
3. Run manual validation
4. Use fallback: Do it yourself + document

### **Common Issues**
- **MCP not responding** â†’ Use manual tools
- **Ralph-Loop infinite** â†’ Set max iterations (10)
- **No internet for Tavily** â†’ Use cached knowledge

---

## âœ… **DEPLOYMENT CHECKLIST**

Before declaring system ready:

- [ ] Serena MCP configured and tested
- [ ] Tavily MCP configured and tested
- [ ] Canva MCP configured and tested
- [ ] Ralph-Loop workflow tested
- [ ] All .claude files created
- [ ] validate.sh working
- [ ] console-check.js working
- [ ] Documentation complete

---

**Remember:** The goal is not to do everything yourself. The goal is to orchestrate the perfect team of agents and MCP servers to deliver 100% error-free results, fast.

**Delegate. Validate. Iterate. Deploy.** ðŸš€